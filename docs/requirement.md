## 時刻読み上げサービス要件定義書 (requirement.md)

---

### 1. 概要 (Overview)

本プロジェクトは、Web技術を用いて指定した間隔で現在時刻を読み上げるシンプルな時報サービスを開発する。

フェーズ1ではブラウザ機能のみでMVPを達成し、フェーズ2で高品質な音声合成と安定性を実現する。

| 項目 | 値 |
| :--- | :--- |
| **サービス名** | 時刻読み上げサービス (仮) |
| **目的** | シンプルなWeb技術のリハビリと、高品質な時報機能の提供。 |
| **ターゲット** | 作業中の時間管理、キッチンタイマー代わりなど、視覚に頼らず時刻を確認したいユーザー。 |

---

### 2. 技術スタック (Technology Stack)
  
| フェーズ | フロントエンド | バックエンド | ホスティング | 音声合成 |
| :--- | :--- | :--- | :--- | :--- |
| **フェーズ 1 (MVP)** | **Next.js** | なし (クライアントサイド完結) | **Vercel / Cloudflare Pages** | **Web Speech API** |
| **フェーズ 2 (製品)** | **Next.js** | **Cloud Run** (VOICEVOX Core) | **Vercel / Cloudflare Pages** | **VOICEVOX** |

---

### 3. 機能要件 (Functional Requirements)

#### 3.1. 時刻表示・同期 (Time Display & Synchronization)

| ID | 要件 | 詳細 |
| :--- | :--- | :--- |
| **FR-01** | **現在時刻の取得** | ユーザーの現在地のローカル時刻を正確に取得・表示すること。 |
| **FR-02** | **デジタル時計** | `HH:MM:SS` 形式のデジタル時刻を表示すること。 |
| **FR-03** | **アナログ時計** | 秒針、分針、時針を備えたアナログ時計を表示すること。 |
| **FR-04** | **秒針同期** | アナログ時計の秒針は、システム時刻の秒と**1秒間隔**で同期して動くこと。ズレを最小限に抑えること。 |

#### 3.2. 読み上げ制御 (Speech Control)

| ID | 要件 | 詳細 |
| :--- | :--- | :--- |
| **FR-05** | **読み上げ間隔設定** | ユーザーが読み上げ間隔を分単位（例: 1, 5, 10, 30, 60分）で選択できること。 |
| **FR-06** | **開始/停止ボタン** | 読み上げタイマーの起動と停止を切り替えるボタンを提供すること。 |
| **FR-07** | **予報音再生** | 読み上げ時刻の**5秒前**から、1秒間隔でビープ音（予報音）を鳴らすこと。 (Web Audio APIを使用) |
| **FR-08** | **時刻読み上げ** | ビープ音の終了と同時に、現在時刻を「**〇時〇分です。**」という形式の日本語テキストで読み上げること。 |

#### 3.3. 設定機能 (Settings)

| ID | 要件 | 詳細 |
| :--- | :--- | :--- |
| **FR-09** | **音量設定** | 読み上げ音声と予報音の音量をスライダーで調整できること。 (`SpeechSynthesisUtterance.volume` および Web Audio APIのGain Nodeを使用) |
| **FR-10** | **音声選択** | 環境で利用可能な音声（`ja-JP`のみ）のリストから、ユーザーが読み上げ音声を選択できること。 |

---

### 4. 非機能要件 (Non-Functional Requirements)

| 項目 | 詳細 |
| :--- | :--- |
| **パフォーマンス** | アナログ時計の秒針はスムーズに動作し、予報音のタイミングは正確であること。 |
| **互換性** | 主要なモダンブラウザ（Chrome, Firefox, Safari）で動作すること。 |
| **セキュリティ** | フェーズ2移行時、VOICEVOX APIキーなどの機密情報をフロントエンドに公開しないこと。 |
| **アーキテクチャ** | フェーズ1のロジックは、フェーズ2への移行時にコアロジックの変更なしに置き換え可能であること。**（抽象化の徹底）** |

---

### 5. フェーズ間の移行戦略 (Migration Strategy)

| 段階 | 実装対象 | 理由 |
| :--- | :--- | :--- |
| **フェーズ 1** | **Web Speech API** | MVPを最速で達成するため。 |
| **事前準備** | **Server Actions** | フェーズ1の段階で、Server Actionsによるデータ取得/再生のフローを想定した抽象化 (`useSpeaker`など) を行う。 |
| **フェーズ 2** | **Cloud Run + Server Actions** | 高品質な音声と安定したサービスを提供するため、VOICEVOXへの切り替えを行う。CORS回避のためにServer Actionsを活用する。 |