## 時刻読み上げサービス要件定義書 (requirement.md)

---

### 1. 概要 (Overview)

本プロジェクトは、Web技術を用いて指定した間隔で現在時刻を読み上げるシンプルな時報サービスを開発する。

フェーズ1ではブラウザ機能のみでMVPを達成し、フェーズ2で高品質な音声合成と安定性を実現する。

- サービス名
  - 時刻読み上げサービス (仮)
- 目的
  - シンプルなWeb技術のリハビリと、高品質な時報機能の提供。
- ターゲット
  - 作業中の時間管理、キッチンタイマー代わりなど、視覚に頼らず時刻を確認したいユーザー。

---

### 2. 技術スタック (Technology Stack)

- フェーズ: フェーズ 1 (MVP)
  - フロントエンド: Next.js
  - バックエンド: なし (クライアントサイド完結)
  - ホスティング: Vercel
  - 音声合成: Web Speech API
- フェーズ: フェーズ 2 (製品)
  - フロントエンド: Next.js
  - バックエンド: Cloud Run (VOICEVOX Core)
  - ホスティング: Vercel
  - 音声合成: VOICEVOX

---

### 3. 機能要件 (Functional Requirements)

#### 3.1. 時刻表示・同期 (Time Display & Synchronization)

1. ID: FR-01
   - 要件: 現在時刻の取得
   - 詳細: ユーザーの現在地のローカル時刻を正確に取得・表示すること。
2. ID: FR-02
   - 要件: デジタル時計
   - 詳細: HH:MM:SS 形式のデジタル時刻を表示すること。
3. ID: FR-03
  - 要件: アナログ時計（フェーズ外）
  - 詳細: アナログ時計は MVP では実装しません。アナログ表示や秒針の高精度同期などの要件は、フェーズ2で必要に応じて検討・追加します。

#### 3.2. 読み上げ制御 (Speech Control)

1. ID: FR-05
   - 要件: 読み上げ間隔設定
   - 詳細: ユーザーが読み上げ間隔を分単位（例: 1, 5, 10, 30, 60分）で選択できること。
2. ID: FR-06
   - 要件: 開始/停止ボタン
   - 詳細: 読み上げタイマーの起動と停止を切り替えるボタンを提供すること。
3. ID: FR-07
   - 要件: 予報音再生
   - 詳細: 読み上げ時刻の5秒前から、1秒間隔でビープ音（予報音）を鳴らすこと。 (Web Audio APIを使用)
4. ID: FR-08
   - 要件: 時刻読み上げ
   - 詳細: ビープ音の終了と同時に、現在時刻を「〇時〇分です。」という形式の日本語テキストで読み上げること。

#### 3.3. 設定機能 (Settings)

1. ID: FR-09
   - 要件: 音量設定
   - 詳細: 読み上げ音声と予報音の音量をスライダーで調整できること。 (SpeechSynthesisUtterance.volume および Web Audio APIのGain Nodeを使用)
2. ID: FR-10
   - 要件: 音声選択
   - 詳細: 環境で利用可能な音声（ja-JPのみ）のリストから、ユーザーが読み上げ音声を選択できること。

---

### 4. 非機能要件 (Non-Functional Requirements)

- 項目: パフォーマンス
  - 詳細: アナログ時計の秒針はスムーズに動作し、予報音のタイミングは正確であること。
- 項目: 互換性
  - 詳細: 主要なモダンブラウザ（Chrome, Firefox, Safari）で動作すること。
- 項目: セキュリティ
  - 詳細: フェーズ2移行時、VOICEVOX APIキーなどの機密情報をフロントエンドに公開しないこと。
- 項目: アーキテクチャ
  - 詳細: フェーズ1のロジックは、フェーズ2への移行時にコアロジックの変更なしに置き換え可能であること。（抽象化の徹底）

---

### 5. フェーズ間の移行戦略 (Migration Strategy)

- 段階: フェーズ 1
  - 実装対象: Web Speech API
  - 理由: MVPを最速で達成するため。
- 段階: 事前準備
  - 実装対象: Server Actions
  - 理由: フェーズ1の段階で、Server Actionsによるデータ取得/再生のフローを想定した抽象化 (useSpeakerなど) を行う。
- 段階: フェーズ 2
  - 実装対象: Cloud Run + Server Actions
  - 理由: 高品質な音声と安定したサービスを提供するため、VOICEVOXへの切り替えを行う。CORS回避のためにServer Actionsを活用する。
  - 拡張項目: アナログ時計の実装
  - 詳細: フェーズ2で必要性が確認でき次第、アナログ表示（秒針を含む高精度な同期）の実装を予定します。実装では requestAnimationFrame や高精度タイマーを用いた秒針同期、パフォーマンス最適化、およびアクセシビリティへの配慮を行います。